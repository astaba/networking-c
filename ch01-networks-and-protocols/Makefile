# ch01-networks-and-protocols/Makefile
# ==============================================================================
.PHONY: \
	all \
	clean
.DELETE_ON_ERROR:
# ******************************************************************************
CC       = gcc
CFLAGS   = -Wall -Wextra
DBGFLAGS = -g3 -O0 -DDEBUG
# ******************************************************************************
MODE    ?= release
# ******************************************************************************
SOURCES  = $(wildcard *.c)
MODULES    = $(subst .c,.o,$(SOURCES))
BINARIES   = $(subst .c,.out,$(SOURCES))
# *****************************************************************************
G_BINARIES = $(subst .c,.dbg.out,$(SOURCES))
# ******************************************************************************

all: $(BINARIES)

# ********************************************  LINK  **************************
$(BINARIES)  : %.out    : %.o
	$(CC) $(CFLAGS) $^ -o $@
# ********************************************  DEBUG BUILD  *******************
$(G_BINARIES): %.dbg.out: %.c
	$(CC) $(CFLAGS) $(DBGFLAGS) $< -o $@
# ********************************************  COMPILE AND ASSEMBLE  **********
$(MODULES)   : %.o      : %.c $(HEADERS)
	$(CC) -c $(CFLAGS) $< -o $@
# ********************************************  CLEAN UP  **********************
clean:
	rm -fv *.o *.out

